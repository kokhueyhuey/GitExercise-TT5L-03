{% extends 'base.html' %}
{% load static %}

{% block content %}
<style>
    .container {
        max-width: 800px;
        margin: 20px auto;
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    h1 {
        text-align: center;
    }

    form {
        margin-top: 20px;
    }

    form .form-group {
        margin-bottom: 15px;
    }

    form label {
        display: block;
        font-weight: bold;
    }

    form input[type="text"],
    form input[type="email"],
    form input[type="date"],
    form input[type="time"],
    #id_pet,
    #id_service,
    #id_checkin,
    #id_checkout {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
    }

    form input[type="submit"] {
        background-color: #007bff;
        color: #fff;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
    }

    .button-container {
        text-align: left;
        margin-top: 20px;
    }

    #messages {
        background-color: grey;
        color: #fff;
        padding: 10px;
        margin-top: 10px;
        text-align: center;
        border-radius: 5px;
    }

    .hidden {
        display: none;
    }
    .time-choice {
    margin-right: 10px;  /* Adjust spacing between buttons */
    margin-bottom: 10px; /* Adjust vertical spacing between buttons */
    padding: 8px 12px;   /* Padding inside the buttons */
    font-size: 14px;     /* Font size of the button text */
    border: 1px solid #ccc;  /* Border color */
    border-radius: 4px;  /* Rounded corners */
    cursor: pointer;     /* Cursor style */
    transition: background-color 0.3s ease; /* Smooth transition for background color */
    }

    .time-choice:hover {
        background-color: #f0f0f0; /* Background color on hover */
    }
</style>

<div class="container">
    <h1>Booking</h1>
    <form method="POST" action="">
        {% csrf_token %}
        <div class="form-group">
            <label for="id_pet">Pet:</label>
            {{ form.pet }}
        </div>
        <div class="form-group">
            <label for="id_service">Service:</label>
            {{ form.service }}
        </div>
        <div class="form-group" id="date-field">
            <label for="id_date">Date:</label>
            {{ form.date }}
        </div>
        <div class="form-group hidden" id="time-field">
            <label for="id_time">Time:</label>
            <div id="time-buttons">
                {% for choice in form.time.choices %}
                    <button type="button" class="time-choice btn btn-outline-primary" data-value="{{ choice.0 }}">{{ choice.1 }}</button>
                {% endfor %}
            </div>
            {{ form.time }}
        </div>     
        <div class="form-group hidden" id="checkin-field">
            <label for="id_checkin">Check-in:</label>
            {{ form.checkin }}
        </div>
        <div class="form-group hidden" id="checkout-field">
            <label for="id_checkout">Check-out:</label>
            {{ form.checkout }}
        </div>

        <div class="button-container">
            <input type="submit" value="Save Booking">
            <a href="{% url 'customer_booking' %}" class="button">View Booking</a>
        </div>

        {% for message in messages %}
        <p id="messages">{{ message }}</p>
        {% endfor %}
    </form>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function() {
    // Function to update time choices based on selected service and date
    function updateTimes() {
        var service = $('#id_service').val();
        var date = $('#id_date').val();

        if (service && date) {
            $.ajax({
                url: '{% url "update_times" %}',
                data: {
                    'service': service,
                    'date': date
                },
                success: function(data) {
                    var timeButtons = $('#time-buttons');
                    timeButtons.empty();
                    $.each(data.available_times, function(key, value) {
                        var button = $('<button></button>')
                            .attr('type', 'button')
                            .addClass('time-choice btn btn-outline-primary')
                            .attr('data-value', key)
                            .text(value);
                        timeButtons.append(button);                    
                    });
                }
            });
        }
    }

    // Toggle visibility of check-in and check-out fields based on service selection
    function toggleFields() {
        var service = $('#id_service').val();

        if (service === 'Pet Hotel' || service === 'Pet Daycare') {
            $('#date-field').addClass('hidden');
            $('#time-field').addClass('hidden');
            $('#checkin-field').removeClass('hidden');
            $('#checkout-field').removeClass('hidden');
        } else {
            $('#date-field').removeClass('hidden');
            $('#time-field').removeClass('hidden');
            $('#checkin-field').addClass('hidden');
            $('#checkout-field').addClass('hidden');
            updateTimes(); // Update times when switching back to regular services
        }
    }

    // Event listeners
    $(document).on('click', '.time-choice', function() {
        var selectedTime = $(this).data('value');
        $('#id_time').val(selectedTime);
    });

    $('#id_service').change(toggleFields);
    $('#id_date').change(updateTimes);
    // Initial state setup
    toggleFields();
    updateTimes();
});
</script>

{% endblock %}
