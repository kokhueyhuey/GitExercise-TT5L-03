{% extends 'base.html' %}
{% load static %}
{% block content %}
<head>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>
<div id="calendar-container">
    <div id="calendar"></div>
    <!-- <div id="button-container">
        <button id="save-button" class="btn btn-primary">Save Changes</button>
    </div> -->
    <div id="legend">
    <div class="legend-item hair-grooming">Hair Grooming</div>
    <div class="legend-item bath-dry">Bath and Dry</div>
    <div class="legend-item daycare-full">Daycare Full Day</div>
    <div class="legend-item daycare-morning">Daycare Morning</div>
    <div class="legend-item daycare-noon">Daycare Noon</div>
</div>

</div>

<script src="https://cdn.jsdelivr.net/npm/dayjs"></script>
<link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.0/main.min.css' rel='stylesheet' />
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.0/main.min.js'></script>

<style>
    #calendar-container {
        width: 70%;
        margin: 40px auto;
        padding: 20px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        background-color: #ffffffc3;
        border-radius: 10px;
    }

    #calendar {
        width: 100%;
        max-width: 100%;
    }

    .fc-event-title {
        color: black;
        font-size: larger;
    }

    .fc-timegrid-slot {
        height: 50px !important;
    }

    #legend {
        width: 70%;
        margin: 20px auto;
        text-align: center;
    }

    .legend-item {
        display: inline-block;
        margin: 5px;
        padding: 5px;
        border-radius: 5px;
        color: white;
    }

    .hair-grooming {
        background-color: #AFEEEE;
    }

    .bath-dry {
        background-color: #87CEFA;
    }

    .daycare-full {
        background-color: #f0e130;
    }

    .daycare-morning {
        background-color: #4682B4;
    }

    .daycare-noon {
        background-color: #FF6347;
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const calendarEl = document.getElementById('calendar');
    const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'timeGridWeek',
        slotDuration: '01:00',
        slotMinTime: '09:00',
        slotMaxTime: '18:00',
        slotLabelFormat: {
            hour: '2-digit',
            minute: '2-digit',
            meridian: 'short'
        },
        allDaySlot: true,
        allDayText: 'day-care',
        height: 'auto',
        expandRows: true,
        contentHeight: 'auto',
        events: [],
        eventClick: function(info) {
            let message = 'Booking Details:\n';
            message += `BOOKINGID: ${info.event.id}\n`;
            message += `Service: ${info.event.extendedProps.service}\n`;
            message += `Owner: ${info.event.extendedProps.owner}\n`;
            message += `Date: ${info.event.start.toLocaleDateString()}\n`;
            message += `Time: ${info.event.start.toLocaleTimeString()}\n`;
            message += `Pet: ${info.event.extendedProps.pet}\n`;

            alert(message.trim());
        },
        // eventDrop: function(info) {
        //     const event = info.event;
        //     const start = info.event.start.toISOString();
        //     const end = info.event.end.toISOString();

        //     // Send an AJAX request to update the event on the server-side
        //     $.ajax({
        //         type: 'POST',
        //         url: '/update-event',
        //         data: {
        //             id: event.id,
        //             start: start,
        //             end: end
        //         },
        //         success: function(response) {
        //             if (response.success) {
        //                 // Update the event's start and end dates on the client-side
        //                 event.start = start;
        //                 event.end = end;
        //             } else {
        //                 // If the update fails, revert the event to its original position
        //                 info.revert();
        //             }
        //         }
        //     });
        // }
    });

    calendar.render();
    fetch("{% url 'get_booking' %}")
        .then(response => response.json())
        .then(events => {
            events.forEach(event => {
                calendar.addEvent(event);
            });
        });
    });

//     fetchEventsAndPopulateCalendar();

//     function fetchEventsAndPopulateCalendar() {
//         fetch("{% url 'get_booking' %}")
//         .then(response => {
//             if (!response.ok) {
//                 throw new Error('Failed to fetch events');
//             }
//             return response.json();
//         })
//         .then(events => {
//             events.forEach(event => {
//                 calendar.addEvent(event);
//             });
//         })
//         .catch(error => {
//             console.error('Error fetching events:', error);
//             alert('Failed to load events');
//         });
//     }

//     function updateEvent(info) {
//         const event = info.event;
//         const start = event.start.toISOString();
//         const end = event.end ? event.end.toISOString() : null;

//         const formData = new FormData();
//         formData.append('id', event.id);
//         formData.append('start', start);
//         formData.append('end', end);
//         formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');

//         fetch("{% url 'update_booking' %}", {
//             method: 'POST',
//             body: formData,
//         })
//         .then(response => response.json())
//         .then(data => {
//             if (data.success) {
//                 console.log('Event updated successfully');
//                 // Refresh the calendar to update the event's position
//                 calendar.refetchEvents();
//             } else {
//                 console.error('Error updating event:', data.error);
//                 info.revert();
//             }
//         })
//         .catch(error => {
//             console.error('Error updating event:', error);
//             info.revert();
//         });
//     }
// });

</script>
{% endblock %}